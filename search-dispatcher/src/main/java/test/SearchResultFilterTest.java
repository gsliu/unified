package test;

import static org.junit.Assert.*;

import org.junit.Test;

import com.vmware.unified.searchdispatcher.SearchResultFilter;

public class SearchResultFilterTest {

	@Test
	public void testFilterText() {
		String input = "SR ID: SR 14469242804 \nTSE Owner:Yue Li\nCustomer:CHINA MOBILE COMMUNICATIONS CORPORATION\nProduct Version/Build Numbers:VMware ESXi 5.0.0 build-623860\nRegressed from previous release?:\nFrequency:Several times\nTime of Failure/Last Occurrence:around 2014-04-24T13:25\nTime Skew between various machines?: <YES/NO ï¿½ if yes, what is it>\nRecent Changes to the Environment?\nDate Opened in Support:4/24/2014 6:13 PM\nGuest: OS/patch/Application\nServer IP/Hostname:\nProblem Area: <Install/Upgrade/DB/Performance Charts etc.>\nAny Third Party products used in the cu environment?: <product name/version>\nDatabase used/version:\nProblem description:\n\nThe customer reported that several VMs hung randomly sometimes,these VMs are using VMXNET3 Nic.\nWhen one VM hit this issue, tried to Ping this VM but failed, when tried to open the console of this VM via vSphere client,\nhit the black screen.\n\nThis issue can be resolved by rebooted this VM. \n\n1. VM \"?? SHOP-MID9 10.208.217.38\"\nThe VM \"?? SHOP-MID9 10.208.217.38\" hung at around 2014-04-24T13:25 when the alarm email was received. Several hours later,\nThe customer supended this VM per our request, please find the VMSS file in the logs bundle \"10G-?? SHOP-MID9 10.208.217.38-vmsupport-2014-04-25@09-31-53.tgz\".\nFor the whole logs bundle of the ESXi host where this VM located, please refer to logs bundle \"sxmcc-oa3-host-11.sxbosscc.com-vmsupport-2014-04-25@10-18-22.tgz\".\n\n\n===========?? SHOP-MID9 10.208.217.38/=========vmware.log===========\nvmware-13.log:2014-03-21T17:10:44.999Z| vcpu-0| Vix: [19793 mainDispatch.c:4084]: VMAutomation_ReportPowerOpFinished: \nstatevar=0, newAppState=1872, success=1 additionalError=0\nvmware-13.log:2014-04-24T12:31:38.667Z| vmx| Vix: [18283 guestCommands.c:2194]: Error VIX_E_TOOLS_NOT_RUNNING in \nVMAutomationTranslateGuestRpcError(): VMware Tools are not running in the guest\nvmware-13.log:2014-04-24T13:50:43.733Z| mks| SOCKET 2 (102) recv error 104: Connection reset by peer\nvmware-13.log:2014-04-24T13:50:43.734Z| mks| SOCKET 2 (102) destroying VNC backend on socket error: 1\nvmware-13.log:2014-04-24T18:04:11.735Z| vmx| OvhdMem OvhdUser_BusError : 1 1 1\n=======================================================================\n\n2. VM \"Neibu-4Aportal-1 10.208.215.55\"\n\nThe VM \"Neibu-4Aportal-1 10.208.215.55\" hit this issue at around 2104-4-26 19:10 when the alarm email was received. \nPlease refer to ESXi logs bundle \"esx-SXMCC-OA3-HOST-1-2014-04-28--04.07.tgz\"\n\n=====Neibu-4Aportal-1 10.208.215.55 =====vmware.log========\n2014-04-22T23:48:00.953Z| vcpu-3| TOOLS Setting autoupgrade-checked TRUE.\n2014-04-22T23:48:02.870Z| mks| SVGA: display status changed, using optimizations for local consoles.\n2014-04-26T19:00:27.784Z| vcpu-0| APIC THERMLVT write: 0x10000\n2014-04-26T19:00:27.789Z| vcpu-2| APIC THERMLVT write: 0x10000\n2014-04-26T19:00:27.789Z| vcpu-1| APIC THERMLVT write: 0x10000\n2014-04-26T19:00:27.789Z| vcpu-3| APIC THERMLVT write: 0x10000\n2014-04-26T19:00:44.766Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-26T19:00:44.767Z| vmx| GuestRpcSendTimedOut: message to toolbox-dnd timed out.\n2014-04-26T19:00:59.769Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-26T19:00:59.769Z| vmx| GuestRpc: app toolbox's second ping timeout; assuming app is down\n2014-04-26T19:00:59.770Z| vmx| GuestRpcSendTimedOut: message to toolbox-dnd timed out.\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: app toolbox-dnd's second ping timeout; assuming app is down\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Reinitializing Channel 0(toolbox)\n2014-04-26T19:00:59.770Z| vmx| GuestMsg: Channel 0, Cannot unpost because the previous post is already completed\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Channel 0 reinitialized.\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Channel 0 reinitialized.\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Reinitializing Channel 2(toolbox-dnd)\n2014-04-26T19:00:59.770Z| vmx| GuestMsg: Channel 2, Cannot unpost because the previous post is already completed\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Channel 2 reinitialized.\n2014-04-26T19:00:59.770Z| vmx| GuestRpc: Channel 2 reinitialized.\n2014-04-26T19:03:59.773Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-26T19:03:59.773Z| vmx| Vix: [45905534 guestCommands.c:2194]: Error VIX_E_TOOLS_NOT_RUNNING in VMAutomationTranslateGuestRpcError(): VMware Tools are not running in the guest\n2014-04-26T19:39:45.080Z| mks| MKS: Base polling period is 10000us\n2014-04-26T19:39:45.097Z| mks| VNCENCODE 2 encoding mode change: (800x600x24depth,32bpp,3200bytes/line)\n2014-04-26T19:39:50.371Z| mks| SVGA: display status changed, using optimizations for remote consoles.\n2014-04-26T19:40:24.688Z| vmx| Vix: [45905534 vmxCommands.c:692]: VMAutomation_Reset. Trying hard reset\n2014-04-26T19:40:24.688Z| vmx|\n2014-04-26T19:40:24.688Z| vmx| -->\n2014-04-26T19:40:24.688Z| vmx| --> VMXRequestReset\n2014-04-26T19:40:24.688Z| vmx| Stopping VCPU threads...\n============================================= \n\n3. VM \"10G-?? SHOP-MID7 10.208.217.36\"\n\nThe VM \"10G-?? SHOP-MID7 10.208.217.36\" hung before 2014/4/24 18:40 when the alarm email was received. \nPlease refer to ESXi logs bundle \"esx-SXMCC-OA3-HOST-10-2014-04-29--04.13.tgz\"\n\n============10G-?? SHOP-MID7 10.208.217.36 2014/4/25 ===vmware.log============\n2014-02-13T06:18:44.788Z| mks| MKS: Base polling period is 1000000us\n2014-02-13T06:18:45.791Z| mks| SVGA: display status changed, using optimizations for local consoles.\n2014-04-24T15:15:43.229Z| vcpu-0| APIC THERMLVT write: 0x10000\n2014-04-24T15:15:43.233Z| vcpu-1| APIC THERMLVT write: 0x10000\n2014-04-24T15:15:43.233Z| vcpu-2| APIC THERMLVT write: 0x10000\n2014-04-24T15:15:43.233Z| vcpu-3| APIC THERMLVT write: 0x10000\n2014-04-24T15:15:50.093Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-24T15:15:50.093Z| vmx| GuestRpcSendTimedOut: message to toolbox-dnd timed out.\n2014-04-24T15:16:05.094Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-24T15:16:05.094Z| vmx| GuestRpc: app toolbox's second ping timeout; assuming app is down\n2014-04-24T15:16:05.095Z| vmx| GuestRpcSendTimedOut: message to toolbox-dnd timed out.\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: app toolbox-dnd's second ping timeout; assuming app is down\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Reinitializing Channel 0(toolbox)\n2014-04-24T15:16:05.095Z| vmx| GuestMsg: Channel 0, Cannot unpost because the previous post is already completed\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Channel 0 reinitialized.\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Channel 0 reinitialized.\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Reinitializing Channel 7(toolbox-dnd)\n2014-04-24T15:16:05.095Z| vmx| GuestMsg: Channel 7, Cannot unpost because the previous post is already completed\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Channel 7 reinitialized.\n2014-04-24T15:16:05.095Z| vmx| GuestRpc: Channel 7 reinitialized.\n2014-04-24T15:19:05.097Z| vmx| GuestRpcSendTimedOut: message to toolbox timed out.\n2014-04-24T15:19:05.097Z| vmx| Vix: [26211158 guestCommands.c:2194]: Error VIX_E_TOOLS_NOT_RUNNING in VMAutomationTrans\nlateGuestRpcError(): VMware Tools are not running in the guest\n2014-04-25T01:03:23.216Z| mks| MKS: Base polling period is 10000us\n2014-04-25T01:03:23.249Z| mks| VNCENCODE 5 encoding mode change: (800x600x24depth,32bpp,3200bytes/line)\n2014-04-25T01:03:28.802Z| mks| SVGA: display status changed, using optimizations for remote consoles.\n2014-04-25T01:03:47.718Z| vmx| Vix: [26211158 vmxCommands.c:692]: VMAutomation_Reset. Trying hard reset\n2014-04-25T01:03:47.719Z| vmx|\n2014-04-25T01:03:47.719Z| vmx| -- >\n2014-04-25T01:03:47.719Z| vmx| -- > VMXRequestReset\n2014-04-25T01:03:47.719Z| vmx| Stopping VCPU threads...\n======================================================================\n\n\"Error VIX_E_TOOLS_NOT_RUNNING in VMAutomationTranslateGuestRpcError(): VMware Tools are not running in the guest\" can be\nfound in vmware.log of each VM, can you confirm if the VMware tools caused this issue?\n\n\nPlease help do analysis on the logs and VM VMSS file?\nThanks a lot.\n\n\n\nImpact: <how many users impacted, production down?, workaround available?>\n Which VMs in questions have problems: <if applicable>\nGuest OS VMX File Path: <if applicable>\n Logs/files location: <logs, screenshots, dumps, DB>\nTechnical Reasons for adding SR to this PR: <crash info, similar logs,\nsymptoms, scenarios>\nSteps to reproduce / what led to this:\n======================================\nIssue Reproducible? N, this issue occurs randomly.\nGSS Repro Attempt Status:\nDetailed Repro Steps:\n\nTroubleshooting done or workarounds applied:\n============================================,Vaib, could you take a look? thanks.,Jyoti is a windows expert...,(In reply to comment #2)\n> Jyoti is a windows expert...\n> \n>       \n\nHi, Jyoti,\n\nWould you pls look into this issue quickly?\nThe customer hit this issue frenquently.\n\nThanks a lot.\n\nRegards,\nYue,sorry for the confusion, this is a Linux bug.\n\nand the stack point to a known 2.6.32 kernel bug.\nsee https://bugzilla.redhat.com/show_bug.cgi?id=644903\n\nVaibhav will provide more information tomorrow.,divide error: 0000 [#1] SMP\nlast sysfs file: /sys/devices/pci0000:00/0000:00:16.0/0000:0b:00.0/irq\nCPU 2\nModules linked in: fuse autofs4 nfs lockd fscache nfs_acl auth_rpcgss sunrpc vsock(U) ipv6 dm_mirror dm_region_hash dm_re shpchp ext4 mbcache jbd2 sd_mod crc_t10dif sr_mod cdrom vmxnet3 vmw_pvscsi pata_acpi ata_generic ata_piix dm_mod [la\n\nModules linked in: fuse autofs4 nfs lockd fscache nfs_acl auth_rpcgss sunrpc vsock(U) ipv6 dm_mirror dm_region_hash dm_re shpchp ext4 mbcache jbd2 sd_mod crc_t10dif sr_mod cdrom vmxnet3 vmw_pvscsi pata_acpi ata_generic ata_piix dm_mod [la\nPid: 0, comm: swapper Not tainted 2.6.32-71.el6.x86_64 #1 VMware Virtual Platform\nRIP: 0010:[<ffffffff81062e9c>]  [<ffffffff81062e9c>] find_busiest_group+0x56c/0xb40\nRSP: 0018:ffff880236ecfcb8  EFLAGS: 00010046\nRAX: 0000000000000000 RBX: ffff880236ecfec4 RCX: 0000000000000000\nRDX: 0000000000000000 RSI: 0000000000000020 RDI: 0000000000000020\nRBP: ffff880236ecfe38 R08: ffff88002f6512d0 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000000 R12: 00000000ffffff01\nR13: 0000000000016980 R14: ffffffffffffffff R15: 0000000000000000\nFS:  0000000000000000(0000) GS:ffff88002f640000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0018 ES: 0018 CR0: 000000008005003b\nCR2: 00007f61ac2bc000 CR3: 000000022f577000 CR4: 00000000000006e0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\nProcess swapper (pid: 0, threadinfo ffff880236ece000, task ffff880236ecd4a0)\nStack:\n ffff880236ecfdd8 ffff880236ecfd48 ffff88002f6510a8 ffff880236ecfeb0\n<0> 00ff880236ebeb30 00ff880200000002 0000000200000000 0000000100000002\n<0> ffff88002f650fa0 0000000000000008 0000000000016980 0000000000016980\nCall Trace:\n [<ffffffff814c864a>] thread_return+0x412/0x778\n [<ffffffff8103be8b>] ? native_safe_halt+0xb/0x10\n [<ffffffff81011ece>] cpu_idle+0xee/0x110\n [<ffffffff814c17c8>] start_secondary+0x1fc/0x23f\nCode: ff c7 85 bc fe ff ff 01 00 00 00 e9 8d fc ff ff 0f 1f 80 00 00 00 00 48 8b 95 e0 fe ff ff 48 8b 45               45\nRIP  [<ffffffff81062e9c>] find_busiest_group+0x56c/0xb40\n RSP <ffff880236ecfcb8>\n\n\ncrash>sys\n    KERNEL: usr/lib/debug/lib/modules/2.6.32-71.el6.x86_64/vmlinux\n    DUMPFILE: vmss.core\n    CPUS: 32\n    DATE: Thu Apr 24 05:26:04 2014\n    UPTIME: 218 days, 20:59:02\n    LOAD AVERAGE: 0.00, 0.00, 0.00\n    TASKS: 677\n    NODENAME: SHOP-MID9\n    RELEASE: 2.6.32-71.el6.x86_64\n    VERSION: #1 SMP Wed Sep 1 01:33:01 EDT 2010\n    MACHINE: x86_64  (2533 Mhz)\n    MEMORY: 8 GB\n    PANIC: \"Kernel panic - not syncing: Fatal exception\"\n\nthe \"divide error\" is because group->cpu_power = 0\n\nIt is the same issue as reported in https://bugzilla.redhat.com/show_bug.cgi?id=644903\n\nIssue on  2.6.32-71.el6.x86_64 which is same  kernel version for known issue on Redhat.\n\nPlease ask customer to update the kernel which included the fix.,According to https://bugzilla.redhat.com/show_bug.cgi?id=644903#c11, RedHat has closed their bug with a resolution of ERRATA.\nClosing this 3rd party bug.,FYI,http://rhn.redhat.com/errata/RHSA-2011-0542.html";
		String query = "find_busiest_group CHINA";
		String result = SearchResultFilter.FilterText(input, query);
		System.out.println(result);

	}

}
